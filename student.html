<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>نتائج الطلاب | مدرسة الخوارزمي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; padding: 20px; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 30px; padding: 30px; width: 100%; max-width: 500px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.3); text-align: center; }
        .search-box { position: relative; margin-top: 20px; }
        .search-box input { border-radius: 15px; padding: 12px 45px 12px 15px; border: 2px solid #eee; font-size: 1rem; width: 100%; }
        .search-box i { position: absolute; right: 15px; top: 18px; color: #aaa; }
        .btn-search { background: #764ba2; color: white; border-radius: 15px; padding: 12px; font-weight: bold; width: 100%; margin-top: 15px; border: none; transition: 0.3s; }
        .btn-search:hover { background: #667eea; transform: scale(1.02); }
        
        /* زر فيسبوك */
        .btn-fb-student { background: #1877F2; color: white !important; border-radius: 15px; padding: 12px; font-weight: bold; text-decoration: none !important; display: block; margin: 25px auto 10px; transition: 0.3s; border: none; }
        .btn-fb-student:hover { background: #145dbf; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(24, 119, 242, 0.3); }

        .result-card { display: none; margin-top: 25px; animation: slideUp 0.5s ease; border-top: 2px dashed #eee; pt-3; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .grade-badge { background: #2ecc71; color: white; padding: 10px 25px; border-radius: 15px; font-size: 2rem; font-weight: bold; margin-top: 5px; display: inline-block; }
        .detail-item { background: #f8f9fa; border-radius: 10px; padding: 8px 15px; margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 0.9rem; }
        
        .footer-credits { font-size: 0.7rem; color: #888; border-top: 1px solid #eee; margin-top: 20px; padding-top: 15px; }
    </style>
</head>
<body>

<div class="glass-card">
    <img src="https://scontent.fxnh2-1.fna.fbcdn.net/v/t39.30808-6/576972140_2238569383306353_9157934115560793734_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=I8lWMg24JEcQ7kNvwErEH7x&_nc_oc=Adl-sBuG7STXqCeEdD6ZQ2zIXrAgZOSBoAFc8W14RR_bi9otK_GHm0VcJoL2D-Zt64A&_nc_zt=23&_nc_ht=scontent.fxnh2-1.fna&_nc_gid=pHSOV56_QdOZQr0aMWTNfA&oh=00_AfqnWR0UG8647G9ARgk1aOIO-IE33_MLAQ5RzPiZEW1GZg&oe=6963FFED" width="80" class="mb-2">
    <h3 class="fw-bold">بوابة النتائج الإلكترونية</h3>
    <p class="text-muted small">مدرسة الخوارزمي - استعلام الدرجات</p>

    <div class="search-box">
        <i class="fas fa-id-card"></i>
        <input type="text" id="studentCode" placeholder="أدخل كود الطالب الخاص بك">
    </div>
    <button class="btn btn-search" onclick="findMyResult()">عرض النتيجة</button>

   <div id="resultArea" class="result-card text-start">
    <div class="text-center mb-3">
        <h4 id="stName" class="fw-bold text-primary mb-1"></h4>
        <span id="stInfo" class="badge bg-light text-dark border"></span>
    </div>
    
    <div class="table-responsive">
        <table class="table table-sm table-bordered text-center shadow-sm">
            <thead class="table-dark">
                <tr style="font-size: 0.8rem;">
                    <th>المادة</th>
                    <th>ف1</th>
                    <th>نصف سنة</th>
                    <th>ف2</th>
                    <th>السعي</th>
                    <th>النهائي</th>
                    <th>المجموع</th>
                </tr>
            </thead>
            <tbody id="subjectsBody" style="font-size: 0.9rem; font-weight: bold;">
                </tbody>
        </table>
    </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // إعدادات الربط (تأكد أن الرابط هو نفس الرابط الذي وضعته في صفحة الإدارة)
  const firebaseConfig = {
    databaseURL: "https://school-project-f09f4-default-rtdb.firebaseio.com/" 
  };
  
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  function findMyResult() {
    let code = document.getElementById('studentCode').value;
    if(!code) { alert("يرجى إدخال الكود أولاً"); return; }

    // إظهار رسالة تحميل بسيطة
    document.querySelector('.btn-search').innerText = "جاري البحث...";

    // البحث في قاعدة البيانات السحابية تحت فرع results
    database.ref('results').once('value').then((snapshot) => {
        let allData = snapshot.val();
        let foundStudent = null;
        let deptInfo = "";

        // البحث داخل الأقسام والمراحل في Firebase
        if (allData) {
            for (let dept in allData) {
                for (let stage in allData[dept]) {
                    let students = allData[dept][stage];
                    let match = students.find(s => s.code === code);
                    if (match) {
                        foundStudent = match;
                        deptInfo = dept + " | " + stage;
                        break;
                    }
                }
                if (foundStudent) break;
            }
        }

        if (foundStudent) {
            // ملء البيانات في الواجهة
            document.getElementById('stName').innerText = foundStudent.name;
            document.getElementById('stInfo').innerText = deptInfo;
            
            const tbody = document.getElementById('subjectsBody');
            tbody.innerHTML = ""; 

            foundStudent.subjects.forEach(sub => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="text-start">${sub.subject}</td>
                    <td>${sub.f1 || '-'}</td>
                    <td>${sub.mid || '-'}</td>
                    <td>${sub.f2 || '-'}</td>
                    <td>${sub.saei || '-'}</td>
                    <td>${sub.finalEx || '-'}</td>
                    <td class="table-success fw-bold">${sub.total || '-'}</td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('resultArea').style.display = 'block';
        } else {
            alert("عذراً، هذا الكود غير موجود في سجلاتنا.");
            document.getElementById('resultArea').style.display = 'none';
        }
        document.querySelector('.btn-search').innerText = "عرض النتيجة";
    }).catch((error) => {
        console.error(error);
        alert("حدث خطأ في الاتصال بالسيرفر");
        document.querySelector('.btn-search').innerText = "عرض النتيجة";
    });
  }
</script>
<div class="text-center mt-4">
    <a href="https://www.facebook.com/profile.php?id=100014599382507" target="_blank" class="btn-facebook">
        <i class="fab fa-facebook"></i> انضم إلى صفحة المدرسة على فيسبوك
    </a>
</div>
<footer class="text-center mt-5 pb-4" style="font-size: 0.85rem; color: #7f8c8d; line-height: 1.8;">
    <div class="container">
        <hr style="width: 50%; margin: 20px auto; opacity: 0.2;">
        <div>مدير المدرسة: <strong>الأستاذ أركان محسن جاسم</strong></div>
        <div>إشراف العمل: <strong>الأستاذ محمد طارق طاهر</strong></div>
        <div class="mt-1" style="color: #4361ee;">برمجة وتصميم: <strong>الطالب مصطفى ساجد عبدالحميد| محمدرضا ماجد</strong></div>
    </div>
</footer>
</body>
</html>